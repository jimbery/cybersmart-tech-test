# Vagrantfile for macOS guest on Apple hardware
Vagrant.configure("2") do |config|
  # Base box - using a macOS box
  config.vm.box = "generic/macos1015"
  # Alternative boxes you can try:
  # config.vm.box = "macos-ventura"
  # config.vm.box = "macos-monterey"

  # VM resources
  config.vm.provider "virtualbox" do |vb|
    vb.memory = "4096"
    vb.cpus = 2
    # Optional: Enable GUI to see macOS desktop
    # vb.gui = true
  end

  # Alternative: Use parallels provider if you have Parallels Desktop
  # config.vm.provider "parallels" do |prl|
  #   prl.memory = 4096
  #   prl.cpus = 2
  # end

  # Boot timeout
  config.vm.boot_timeout = 600

  # Network: forward Electron dev server port
  config.vm.network "forwarded_port", guest: 3000, host: 3003

  # Communicator: SSH (macOS uses SSH instead of WinRM)
  config.vm.communicator = "ssh"
  config.ssh.username = "vagrant"
  config.ssh.password = "vagrant"
  # Or use private key authentication
  config.ssh.insert_key = false

  # Sync folder - adjusted for macOS paths
  config.vm.synced_folder "../", "/Users/vagrant/ElectronApp"

  # Provisioning for macOS
  config.vm.provision "shell", inline: <<-SHELL
    #!/bin/bash
    
    # Install Homebrew (macOS package manager)
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    
    # Add Homebrew to PATH
    echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> /Users/vagrant/.zprofile
    eval "$(/opt/homebrew/bin/brew shellenv)"
    
    # Install Node.js and Git
    brew install node git
    
    # Navigate to synced folder and install dependencies
    cd /Users/vagrant/ElectronApp
    npm install
    
    echo "Provisioning completed successfully!"
  SHELL
end