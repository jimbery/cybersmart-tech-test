# Vagrantfile for Windows 10 with VirtualBox
Vagrant.configure("2") do |config|
  # Base box - replace with a valid Windows box from Vagrant Cloud
  config.vm.box = "gusztavvargadr/windows-10"
  config.vm.guest = :windows
  config.vm.boot_timeout = 1200

  # VM resources for VirtualBox
  config.vm.provider "virtualbox" do |vb|
    vb.memory = 4096
    vb.cpus = 2
    vb.gui = true

    # --- Display / graphics settings ---
    vb.customize ["modifyvm", :id, "--vram", "256"]          # Video memory in MB
    vb.customize ["modifyvm", :id, "--graphicscontroller", "vmsvga"]  # Use VMSVGA for EFI
    vb.customize ["modifyvm", :id, "--accelerate3d", "on"]  # Enable 3D acceleration

    # Optional: Enable EFI if your box supports it
    # vb.customize ["modifyvm", :id, "--firmware", "efi"]
  end
 
  # Network: forward Electron dev server port
  config.vm.network "forwarded_port", guest: 3000, host: 3003, auto_correct: true

  # # Communicator: WinRM (for Windows boxes)
  # config.vm.communicator = "winrm"
  # config.winrm.username = "vagrant"
  # config.winrm.password = "vagrant"

  config.vm.provision "shell", inline: <<-POWERSHELL
    Remove-Item -Recurse -Force "/Users/vagrant/ElectronApp"
  POWERSHELL

  config.vm.provision "file", source: "../", destination: "/Users/vagrant/ElectronApp"


  # Provisioning with PowerShell
  config.vm.provision "shell", inline: <<-POWERSHELL
    # Set execution policy
    Set-ExecutionPolicy Bypass -Scope Process -Force

    # Ensure TLS 1.2
    [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072

    # Install Chocolatey
    iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

    # Install Node.js LTS and Git
    choco install -y nodejs-lts git

    refreshenv

    # Navigate to synced folder and install dependencies
    cd /Users/vagrant/ElectronApp
    npm install

    Write-Host "Provisioning completed successfully!"
  POWERSHELL
end
